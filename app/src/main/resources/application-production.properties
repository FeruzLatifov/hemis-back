# =====================================================
# HEMIS APPLICATION - PRODUCTION CONFIGURATION
# =====================================================
# CRITICAL: Configure ALL properties before deploying to production!
# =====================================================

# =====================================================
# SERVER CONFIGURATION
# =====================================================
server.port=8080
server.servlet.context-path=/

# Enable HTTPS in production
server.ssl.enabled=true
server.ssl.key-store=classpath:keystore.p12
server.ssl.key-store-password=${SSL_KEYSTORE_PASSWORD}
server.ssl.key-store-type=PKCS12
server.ssl.key-alias=hemis

# =====================================================
# DATABASE CONFIGURATION
# =====================================================
spring.datasource.url=jdbc:postgresql://${DB_MASTER_HOST}:${DB_MASTER_PORT}/${DB_MASTER_NAME}
spring.datasource.username=${DB_MASTER_USERNAME}
spring.datasource.password=${DB_MASTER_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection pool (HikariCP)
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# JPA / Hibernate
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
# hibernate.dialect auto-detected (removed explicit PostgreSQLDialect)
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# =====================================================
# SECURITY CONFIGURATION
# =====================================================

# OAuth2 Resource Server (JWT)
security.oauth2.issuer-uri=${OAUTH2_ISSUER_URI:https://auth.hemis.uz/realms/hemis}
security.oauth2.jwk-set-uri=${OAUTH2_JWK_SET_URI:https://auth.hemis.uz/realms/hemis/protocol/openid-connect/certs}
security.oauth2.token-expiration-seconds=3600
security.oauth2.refresh-token-expiration-seconds=86400

# CORS Configuration
security.cors.enabled=true
security.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://university1.uz,https://university2.uz,https://admin.hemis.uz}
security.cors.max-age=3600

# Rate Limiting
security.rate-limit.enabled=true
security.rate-limit.requests-per-minute=100
security.rate-limit.burst-capacity=200
security.rate-limit.global-requests-per-minute=1000

# API Security
security.api.require-https=true
security.api.log-requests=true
security.api.log-responses=false
security.api.max-request-size=10485760

# =====================================================
# EXTERNAL GOVERNMENT API CONFIGURATION
# =====================================================

# MVD (Ministry of Internal Affairs) API
external.api.mvd.url=${MVD_API_URL:https://api.mvd.gov.uz}
external.api.mvd.token=${MVD_API_TOKEN}
external.api.mvd.timeout=30000

# Passport API
external.api.passport.url=${PASSPORT_API_URL:https://api.passport.gov.uz}
external.api.passport.token=${PASSPORT_API_TOKEN}
external.api.passport.timeout=30000

# BIMM (Birth/Death Registration) API
external.api.bimm.url=${BIMM_API_URL:https://api.bimm.uz}
external.api.bimm.token=${BIMM_API_TOKEN}
external.api.bimm.timeout=30000

# Social Protection API
external.api.social.url=${SOCIAL_API_URL:https://api.mehnat.uz}
external.api.social.token=${SOCIAL_API_TOKEN}
external.api.social.timeout=30000

# GUVD (Police) API
external.api.guvd.url=${GUVD_API_URL:https://api.guvd.gov.uz}
external.api.guvd.token=${GUVD_API_TOKEN}
external.api.guvd.timeout=30000

# Tax Committee API
external.api.tax.url=${TAX_API_URL:https://api.soliq.uz}
external.api.tax.token=${TAX_API_TOKEN}
external.api.tax.timeout=30000

# =====================================================
# LOGGING CONFIGURATION
# =====================================================
logging.level.root=INFO
logging.level.uz.hemis=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=WARN

# Log file configuration
logging.file.name=/var/log/hemis/application.log
logging.file.max-size=100MB
logging.file.max-history=30
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Request/Response logging
logging.level.uz.hemis.app.controller=INFO

# =====================================================
# ACTUATOR CONFIGURATION
# =====================================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# Metrics
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# =====================================================
# APPLICATION PROPERTIES
# =====================================================
spring.application.name=hemis-api
spring.profiles.active=production

# JSON formatting
spring.jackson.serialization.indent-output=false
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=Asia/Tashkent

# Upload file size
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# =====================================================
# CACHE CONFIGURATION (Optional - for performance)
# =====================================================
# spring.cache.type=redis
# spring.data.redis.host=${REDIS_HOST:localhost}
# spring.data.redis.port=${REDIS_PORT:6379}
# spring.data.redis.password=${REDIS_PASSWORD}
# spring.data.redis.timeout=60000

# =====================================================
# MONITORING & ALERTING (Optional)
# =====================================================
# Sentry for error tracking
# sentry.dsn=${SENTRY_DSN}
# sentry.environment=production
# sentry.traces-sample-rate=0.1

# =====================================================
# ENVIRONMENT VARIABLES REQUIRED
# =====================================================
# DB_HOST=production-db-server.uz
# DB_PORT=5432
# DB_NAME=hemis
# DB_USERNAME=hemis_production_user
# DB_PASSWORD=<strong-password-here>
# SSL_KEYSTORE_PASSWORD=<keystore-password>
# OAUTH2_ISSUER_URI=https://auth.hemis.uz/realms/hemis
# OAUTH2_JWK_SET_URI=https://auth.hemis.uz/realms/hemis/protocol/openid-connect/certs
# CORS_ALLOWED_ORIGINS=https://university1.uz,https://university2.uz,https://admin.hemis.uz
# MVD_API_TOKEN=<real-mvd-api-token>
# PASSPORT_API_TOKEN=<real-passport-api-token>
# BIMM_API_TOKEN=<real-bimm-api-token>
# SOCIAL_API_TOKEN=<real-social-api-token>
# GUVD_API_TOKEN=<real-guvd-api-token>
# TAX_API_TOKEN=<real-tax-api-token>
