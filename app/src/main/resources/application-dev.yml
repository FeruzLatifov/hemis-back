# =====================================================
# HEMIS Development Profile
# =====================================================

spring:
  # =====================================================
  # Development DataSource
  # =====================================================
  # Development: Single database (no master/replica split)
  # .env fayldan o'qiydi: DB_MASTER_HOST, DB_MASTER_NAME, etc.
  # =====================================================

  datasource:
    url: jdbc:postgresql://${DB_MASTER_HOST:localhost}:${DB_MASTER_PORT:5432}/${DB_MASTER_NAME:hemis4}
    username: ${DB_MASTER_USERNAME:postgres}
    password: ${DB_MASTER_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      pool-name: HikariPool-Dev

  # =====================================================
  # Development JPA Configuration
  # =====================================================

  jpa:
    show-sql: true  # Log SQL statements

    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true

  # =====================================================
  # Development Flyway Configuration
  # =====================================================
  # BEST PRACTICE: Configured to work with existing database
  # Currently DISABLED - enable when needed for new migrations
  # =====================================================

  flyway:
    # TOGGLE: Set to true when you need to run migrations
    enabled: true  # Enabled to run V5 I18n migration

    # Baseline configuration (for existing databases)
    baseline-on-migrate: true  # Mavjud bazani baseline sifatida qabul qiladi
    baseline-version: 0  # Barcha migration'lar baseline'dan keyin ishga tushadi

    # Safety settings
    clean-disabled: true  # NEVER allow flyway clean in any environment
    validate-on-migrate: true  # Migration'larni validatsiya qiladi

    # Flexibility for development
    out-of-order: true  # Tartibsiz migration'larni qabul qiladi
    mixed: true  # Transactional va non-transactional SQL'ni aralash ishlatish

    # PostgreSQL specific
    # CREATE INDEX CONCURRENTLY requires non-transactional execution

  # =====================================================
  # Redis Configuration - ENABLED for Permission Caching
  # =====================================================

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 2000ms
      jedis:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms

  cache:
    type: redis  # Enable Redis cache
    redis:
      time-to-live: 3600000  # 1 hour (in milliseconds)
      cache-null-values: false
      use-key-prefix: true
      key-prefix: "hemis:"

  # =====================================================
  # DevTools
  # =====================================================

  devtools:
    restart:
      enabled: true
      additional-paths:
        - src/main/java

    livereload:
      enabled: true

# =====================================================
# Server Configuration (Development)
# =====================================================

server:
  port: 8081

  error:
    include-stacktrace: always  # Full stack traces in dev

# =====================================================
# Logging (Development - Verbose)
# =====================================================

logging:
  level:
    root: INFO
    uz.hemis: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.flywaydb: DEBUG

  pattern:
    console: "%clr(%d{HH:mm:ss.SSS}){faint} %clr(%5p) %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx"

# =====================================================
# HEMIS Development Configuration
# =====================================================

hemis:
  cors:
    allowed-origins:
      - http://localhost:3000
      - http://localhost:5173
      - http://127.0.0.1:3000
      - http://127.0.0.1:5173

  security:
    jwt:
      # Development JWT configuration
      secret: ${JWT_SECRET:dev-secret-key-change-in-production-this-is-only-for-development-min-64-chars}
      expiration: ${JWT_EXPIRATION:86400000}
      refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000}
      jwk-set-uri: ${JWT_JWK_SET_URI:}

  database:
    enforce-no-delete: true  # Still enforce in dev

# =====================================================
# SpringDoc OpenAPI (Swagger) Configuration
# =====================================================

springdoc:
  api-docs:
    path: /v3/api-docs  # OpenAPI JSON
    enabled: true

  swagger-ui:
    path: /swagger-ui.html  # Swagger UI page
    enabled: true
    try-it-out-enabled: true  # Enable "Try it out" button
    operations-sorter: method  # Sort by HTTP method
    tags-sorter: alpha  # Alphabetical (with 00., 01. ... normalized)
    doc-expansion: none  # Collapse all tags and operations by default
    display-request-duration: true
    default-models-expand-depth: 3
    filter: true
    urlsPrimaryName: all

  # Show only public methods
  show-actuator: false

# =====================================================
# Development Notes
# =====================================================
# - Database: External PostgreSQL (configure via env vars)
# - Redis: Docker (localhost:6379)
# - Run with: ./gradlew :app:bootRun
# - Or: Run HemisApplication.java in IntelliJ
# - Hot reload enabled (DevTools)
# - SQL logging enabled
# - Full stack traces on errors
# =====================================================
