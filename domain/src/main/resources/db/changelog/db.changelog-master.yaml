databaseChangeLog:
  # =====================================================
  # HEMIS DATABASE MIGRATIONS
  # =====================================================
  # Industry Best Practices (Large Project Structure):
  # - Nested structure: schema/, seed/, migration/
  # - 1 file = 1 table (granular changesets)
  # - preConditions instead of IF NOT EXISTS
  # - Idempotent seeds (ON CONFLICT DO UPDATE)
  # - Rollback scripts alongside main files
  # =====================================================

  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  # PHASE 1: SCHEMA (DDL) - changesets/schema/
  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  - changeSet:
      id: V001_create_users
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: users
      changes:
        - sqlFile:
            path: changesets/schema/V001_create_users.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V001_create_users_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: V002_create_roles
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: roles
      changes:
        - sqlFile:
            path: changesets/schema/V002_create_roles.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V002_create_roles_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: V003_create_permissions
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: permissions
      changes:
        - sqlFile:
            path: changesets/schema/V003_create_permissions.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V003_create_permissions_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: V004_create_user_roles
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: user_roles
      changes:
        - sqlFile:
            path: changesets/schema/V004_create_user_roles.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V004_create_user_roles_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: V005_create_role_permissions
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: role_permissions
      changes:
        - sqlFile:
            path: changesets/schema/V005_create_role_permissions.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V005_create_role_permissions_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: V006_create_system_messages
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: system_messages
      changes:
        - sqlFile:
            path: changesets/schema/V006_create_system_messages.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V006_create_system_messages_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: V007_create_system_message_translations
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: system_message_translations
      changes:
        - sqlFile:
            path: changesets/schema/V007_create_system_message_translations.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V007_create_system_message_translations_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: V008_create_menus
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: menus
      changes:
        - sqlFile:
            path: changesets/schema/V008_create_menus.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V008_create_menus_rollback.sql
            relativeToChangelogFile: true

  # V009, V010 - Languages (renamed from V011, V012)

  - changeSet:
      id: V009_create_languages
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: languages
      changes:
        - sqlFile:
            path: changesets/schema/V009_create_languages.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V009_create_languages_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: V010_create_language_translations
      author: hemis-team
      preConditions:
        - onFail: MARK_RAN
        - not:
            tableExists:
              tableName: language_translations
      changes:
        - sqlFile:
            path: changesets/schema/V010_create_language_translations.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/schema/V010_create_language_translations_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: tag-schema-complete
      author: hemis-team
      changes:
        - tagDatabase:
            tag: schema-v1.0

  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  # PHASE 2: SEED DATA (DML) - changesets/seed/
  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  - changeSet:
      id: S001_seed_roles
      author: hemis-team
      changes:
        - sqlFile:
            path: changesets/seed/S001_seed_roles.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/seed/S001_seed_roles_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: S002_seed_permissions_core
      author: hemis-team
      changes:
        - sqlFile:
            path: changesets/seed/S002_seed_permissions_core.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/seed/S002_seed_permissions_core_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: S003_seed_permissions_admin
      author: hemis-team
      changes:
        - sqlFile:
            path: changesets/seed/S003_seed_permissions_admin.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/seed/S003_seed_permissions_admin_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: S003b_seed_permissions_menu
      author: hemis-team
      changes:
        - sqlFile:
            path: changesets/seed/S003b_seed_permissions_menu.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sql: |
            DELETE FROM permissions WHERE code LIKE 'registry.%';
            DELETE FROM permissions WHERE code LIKE 'rating.%';
            DELETE FROM permissions WHERE code LIKE 'data.%';
            DELETE FROM permissions WHERE code LIKE 'reports.%' AND code != 'reports.view';
            DELETE FROM permissions WHERE code LIKE 'system.%' AND code NOT IN ('settings.view', 'settings.edit');

  - changeSet:
      id: S004_seed_role_permissions
      author: hemis-team
      changes:
        - sqlFile:
            path: changesets/seed/S004_seed_role_permissions.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/seed/S004_seed_role_permissions_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: S005_seed_languages
      author: hemis-team
      changes:
        - sqlFile:
            path: changesets/seed/S005_seed_languages.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/seed/S005_seed_languages_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: S006_seed_translations
      author: hemis-team
      changes:
        - sqlFile:
            path: changesets/seed/S006_seed_translations.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sql: |
            DELETE FROM system_message_translations WHERE message_id IN (
              SELECT id FROM system_messages WHERE category = 'menu'
            );
            DELETE FROM system_messages WHERE category = 'menu';

  - changeSet:
      id: tag-seed-complete
      author: hemis-team
      changes:
        - tagDatabase:
            tag: seed-v1.0

  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  # PHASE 3: MIGRATION (Legacy Data) - changesets/migration/
  # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  - changeSet:
      id: M001_migrate_old_hemis_users
      author: hemis-team
      changes:
        - sqlFile:
            path: changesets/migration/M001_migrate_old_hemis_users.sql
            relativeToChangelogFile: true
            splitStatements: false
      rollback:
        - sqlFile:
            path: changesets/migration/M001_migrate_old_hemis_users_rollback.sql
            relativeToChangelogFile: true

  - changeSet:
      id: tag-v1.0.0
      author: hemis-team
      changes:
        - tagDatabase:
            tag: v1.0.0
